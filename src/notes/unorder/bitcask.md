---
title: 面试项目
icon: fa-solid fa-database
category: note
tag:
  - bitcask
  - kv
---
## BitCask
### 简介
bitcask是一个kv数据库，和市面上常见的Redis不同的是，它是直接把数据存储到磁盘上的。是一个面向磁盘的kv数据库。

一个 bitcask 实例就是系统上的一个目录，并且限制同一时刻只能有一个进程打开这个目录。目录中有多个文件，同一时刻只有一个活跃的文件用于写入。
当活跃文件写到满足一个==阈值==之后，就会被关闭，成为旧的数据文件，并且打开一个新的文件用于写入。
所以这个目录中就是一个活跃文件和多个旧的数据文件的集合。
当前活跃文件的写入是追加写入的，这意味着可以利用顺序 IO，不会有多余的磁盘寻址，最大限度保证了吞吐。

删除操作实际上也是一次追加写入，只不过写入的是一个特殊的墓碑值，用于标记一条记录的删除，也就是说不会实际去删除某条数据。当下次 merge 的时候，才会将这种无效的数据清理掉。

merge 会遍历所有不可变的旧数据文件，将所有有效的数据重新写到新的数据文件中，并且将旧的数据文件删除掉。
merge完成之后内存中的索引会更新。
merge 完成后，还会为每个数据文件生成一个 hint 文件，hint 文件可以看做是全部数据的索引，它和数据文件唯一的区别是，它不会存储实际的 value。

它的作用是在 bitcask 启动的时候，直接加载 hint 文件中的数据，快速构建索引，而不用去全部重新加载数据文件，换句话说，就是在启动的 时候加载更少的数据，因为 hint 文件不存储 value，它的容量会比数据文件小。

### 索引
bitcask选择了art（自适应基数树）树做为索引，可以通过压缩节点（将两个相同前缀的键值合并在一起）来减少内存占用。这样就可以在内存中存储更多的索引。

[art树介绍]( https://www.codercto.com/a/117148.html)

### 如何保证可靠性
- 先写日志
- 数据顺序写入
- 定期合并
- 数据校验
## nanogo
### 路由树
使用Trie树（字典树）来实现
### 函数级中间件
重写http的handle函数，完全匹配请求方法和路由名称
### 接下来的发展
- 添加模板渲染支持
### WaveLog
异步日志库，使用channel和goroutine来实现异步写入。
当文件到达设置的阈值时，会创建一个新的文件，并将日志写入新的文件中。
会按照不同的日志级别，将日志写入不同的文件中。